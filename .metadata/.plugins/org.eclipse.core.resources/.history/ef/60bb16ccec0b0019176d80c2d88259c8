package dss.miguel.p2.modelo;

import java.util.List;
import java.util.HashMap;
import java.util.Map;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;
import javax.persistence.Query;
import javax.persistence.EntityTransaction;

public enum BDUsuario {
	
	INSTANCE; //Buena forma de implementar un singleton
	
	private static final String PERSISTENCE_UNIT_NAME = "practica2";
	private final EntityManagerFactory factoria = Persistence.createEntityManagerFactory(PERSISTENCE_UNIT_NAME);
	private final EntityManager em = factoria.createEntityManager();
	
	private BDUsuario() {
		Usuario u1 = new Usuario("Fernando", "u1@email.com");
		Usuario u2 = new Usuario("Hernando", "u2@email.com");
		
		EntityTransaction t = em.getTransaction();
		t.begin();
		em.persist(u1);
		em.persist(u2);
		t.commit();
		em.close();
	}
	
	public List getUsuarios(){
		Query q = em.createQuery("SELECT * FROM Usuario u");
		return q.getResultList();
	}
	
	public void postUsuario(String name, String email) {
		Usuario u = new Usuario(name, email);
		EntityTransaction t = em.getTransaction();
		t.begin();
		em.persist(u);
		t.commit();
		em.close();
	}
	
	public void deleteUsuario(String id) {
		EntityTransaction t = em.getTransaction();
		t.begin();
		em.createQuery("DELETE FROM Usuario WHERE id="+id);
		t.commit();
		em.close();
	}
	
//Metodos necesarios:
	//POST
	//GETAll
	//DELETE
	
	public static void main(String[] args) {
// leer las entradas existentes y escribir en la consola
		Query q = em.createQuery("select t from Completo t");
//Crearse una lista con template: "Completo" a la que asignameros el resultado de la consulta
//en la base de datos ("q.getResultList()"
//Iterar en la lista e imprimir las instancias "completo"
//Ahora imprimimos el numero de registros que tiene ya la base de datos
		System.out.println("Tamano: " + listaCompleto.size());
	}
}